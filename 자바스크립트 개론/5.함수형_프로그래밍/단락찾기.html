<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
    var RECLUSEFILE =
        "%% 제목\n\n평서문평서문평서문평서문평서문평서문평서문평서문평서문평서문평서문{각주각주각주각주각주각주각주}평서문평서문평서문평서문평서문\n\n" +
        "*강조문강조문강조문강조문강조문강조문*평서문평서문평서문평서문평서문평서문평서문평서문평서문"

    function spiltParagraph(text) {
        function split(pos) {
            if (pos == text.length) {
                return [];
            } else if (text.charAt(pos) == "*") {
                var end = findClosing("*", pos + 1),
                    frag = {type: "강조", content: text.slice(pos + 1, end)};
                return [frag].concat(split(end + 1));
            } else if (text.charAt(pos) == "{") {
                var end = findClosing("}", pos + 1),
                    frag = {type: "각주", content: text.slice(pos + 1, end)};
                return [frag].concat(split(end + 1));
            } else {
                var end = findOpeningOrEnd(pos),
                    frag = {tyop: "평문", content: text.slice(pos, end)};
                return [frag].concat(split(end));
            }
        }

        function findClosing(character, from) {
            var end = text.indexOf(character, from);
            if (end == -1) throw new Error("닫는 '" + character + "'가 누락됨")
            else return end;
        }

        function findOpeningOrEnd(from) {
            function indexOrEnd(character) {
                var index = text.indexOf(character, from);
                return index == -1 ? text.length : index;
            }

            return Math.min(indexOrEnd("*"), indexOrEnd("{"));
        }

        return split(0);
    }

    console.log(spiltParagraph(RECLUSEFILE))


    // var paragraphs = RECLUSEFILE.split("\n\n");
    // function processParagraph(paragraph) {
    //     var header = 0;
    //     while (paragraph.charAt(header) == "%")
    //         header++;
    //     if (header > 0)
    //         return {type: "h" + header, content: paragraph.slice(header + 1)};
    //     else
    //         return {type: "p", content: paragraph};
    // }
    // var sapratedParagraphs = paragraphs.map(processParagraph);


</script>
</body>
</html>